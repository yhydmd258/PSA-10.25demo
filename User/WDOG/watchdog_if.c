/******************************************************************************								
*  Name: .c
*  Description: 
*  Project: C_demo
*  Auther:  shanghai tianma
*              R&D center
*              penghu
*  MCU: S9KEAZ128AMLH
*  Comment:
******************************************************************************/		
#include "project_cfg.h" 
#ifdef  WATCHDOG_MODULE
#include <string.h>
#include "watchdog_if.h"
#include "watchdog_ctrl.h"

#ifdef RTC_MODULE
#include "RTC/rtc_if.h"
#endif

/**********************************************************************************************
* External objects
**********************************************************************************************/


/**********************************************************************************************
* Global variables
**********************************************************************************************/

/**********************************************************************************************
* Constants and macros
**********************************************************************************************/

/**********************************************************************************************
* Local types
**********************************************************************************************/


/**********************************************************************************************
* Local function prototypes
*********************************************************************************************/

/**********************************************************************************************
* Local variables
**********************************************************************************************/


/**********************************************************************************************
* Local functions
**********************************************************************************************/


/**********************************************************************************************
* Global functions
**********************************************************************************************/
/***********************************************************************************************
*
* @brief      init the watchdog
* @param    none
* @return   none
*
************************************************************************************************/
void Watchdog_If_Init(void)
{
#ifdef RTC_MODULE
    RTC_If_Init();
    RTC_If_Callback_Set(Watchdog_Ctrl_Timer);
#endif
}

/***********************************************************************************************
*
* @brief      init the watchdog
* @param    none
* @return   none
*
************************************************************************************************/
void Watchdog_If_Deinit(void)
{
    Watchdog_Ctrl_Deinit();
#ifdef RTC_MODULE
    RTC_If_Callback_Set(NULL);
    RTC_If_Deinit();
#endif

}
/***********************************************************************************************
*
* @brief      set the time of watchdog
* @param    none
* @return   none
*
************************************************************************************************/
void Watchdog_If_Set(uint16_t time)
{
    static uint8_t Cfg_flag =0;
    
    if(Cfg_flag)
        Watchdog_Ctrl_Reconfigure(time);
    else
    {
        Watchdog_Ctrl_Configure(time);
        Cfg_flag = 1;
    }
}

/***********************************************************************************************
*
* @brief     wait the watchdog time up
* @param    none
* @return   none
*
************************************************************************************************/
void Watchdog_If_Waiting(void)
{
    while(!Watchdog_Ctrl_Reach_Flag_Get());
}

/***********************************************************************************************
*
* @brief      refresh the time
* @param    none
* @return   none
*
************************************************************************************************/
void Watchdog_If_Refresh(void)
{
    Watchdog_Ctrl_Refresh();
}

#endif/* WATCHDOG_MODULE */
